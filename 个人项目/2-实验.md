# 实验项目：基于MySQL全文索引构建简单的中文“搜索引擎”
### 基础实验：实验全文索引
全文索引的创建：
1)在创建表时创建全文索引
create table fulltext_test (
    id int(11) NOT NULL AUTO_INCREMENT,
    content text NOT NULL,
    tag varchar(255),
    PRIMARY KEY (id),
    FULLTEXT KEY content_tag_fulltext(content,tag)  // 创建联合全文索引列
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

测试全文索引
添加测试数据
创建测试表，插入测试数据
create table test (
    
id int(11) unsigned not null auto_increment,
    
content text not null,
    
primary key(id),
    
fulltext key content_index(content)
//该句为创建全文索引
) engine=MyISAM default charset=utf8;

insert into test (content) values ('a'),('b'),('c');  
insert into test (content) values ('aa'),('bb'),('cc');  

insert into test (content) values ('aaa'),('bbb'),('ccc');
insert into test (content) values ('aaaa'),('bbbb'),('cccc');

按照全文索引的使用语法执行下面查询：
select * from test where match(content) against('a');
select * from test where match(content) against('aa');
select * from test where match(content) against('aaa');
select * from test where match(content) against('aaaa');

MySQL中有最小搜索长度和最大搜索长度两个变量，搜索后得出的结果要在这两个值的区间内
使用全文索引时，测试表里至少要有四条以上的记录
其默认值可以通过下面的语句来查看：
show variables like '%ft%';
// MyISAM
ft_min_word_len = 4;
ft_max_word_len = 84;

// InnoDB
innodb_ft_min_token_size = 3;
innodb_ft_max_token_size = 84;
1
2
3
4
5
6
7
可以看到最小搜索长度 MyISAM 引擎下默认是 4，InnoDB 引擎下是 3，也即，MySQL 的全文索引只会对长度大于等于 4 或者 3 的词语建立索引，而刚刚搜索的只有 aaaa 的长度大于等于 4。


## 基于全文索引，构建简单的“搜索引擎”(本实验测试的是使用INNODB引擎来进行全文索引)  
### 准备工作：  
##### 1.实验目标：  
- 查询文章中是否含有某个关键词；一系列文章出现某个关键词的次数  
- 查询文章的标题是否含有某个关键词  
##### 2.设置参数从而减少磁盘IO压力：  
SET GLOBAL sync_binlog=100;  
SET GLOBAL innodb_flush_log_at_trx_commit=2;  
##### 3.导入1kw条数据(1.57G)对全文索引进行测试  
数据来源：https://pan.baidu.com/s/1aaB1R3bkBGZRMEx0o6T61w  
##### 4.创建该测试所依据的文章表，其SQL语句如下：  
CREATE TABLE `article` (  
  `id` bigint(10) NOT NULL,  
  `url` varchar(1024) CHARACTER SET latin1 NOT NULL DEFAULT '',  
  `title` varchar(256) NOT NULL DEFAULT '',  
  `source` varchar(32) DEFAULT '' COMMENT '真实来源',  
  `keywords` varchar(32) DEFAULT NULL,  
  `publish_time` timestamp NULL DEFAULT NULL,  
  PRIMARY KEY (`id`),  
  KEY `title_idx` (`title`)  
) ENGINE=InnoDB  
##### 5.查看导入后的总数据量  
##### 查看导入后的数据文件和索引文件的大小
### 创建全文索引的方式有以下两种，一是使用默认方式创建全文索引，二是使用ngram分词解析器创建个人索引，二者的区别是前者通过字符分词，后者根据数量来进行分词。
#### 一.使用默认方式创建全文索引
##### 1.查看该表已有的关键词字段
##### 2.对不建立全文索引时和建立全文索引时进行对比：
##### 3.对关键词字段创建全文索引（以','作为分词）
###### 3.1设置自定义stopwords（分词）
设置自定义stopwords（分词）
use fulltext_test;
create table my_stopwords(value varchar(20)) ENGINE=INNODB;
insert into my_stopwords(value) value(',');
SET GLOBAL innodb_ft_server_stopword_table = 'mysql/my_stopwords';
查看可查询字词的最小长度和建好的分词表
SHOW GLOBAL  VARIABLES WHERE Variable_name IN('innodb_ft_min_token_size','innodb_ft_server_stopword_table');
##### 3.2创建全文索引
alter table article add fulltext index idx_full_keyword(keywords);
##### 3.3查看磁盘空间
##### 3.4利用创建的全文索引查询某个关键词出现的次数
##### 3.5 如需同时匹配多个关键词（也就是包含多个关键词），用布尔全文搜索
e.g.:


表示完全匹配 "三里屯,北京" 的记录数


select count(*) from article where match(keywords)  against('+三里屯,北京' in boolean mode);

表示匹配“三里屯” 或者 “北京”的记录数


select count(*) from article where match(keywords)  against('三里屯,北京');

### 实验结论：
- 对于全文索引来说，字段程度越大，建立的全文索引的长度也就越大
- 当MySQL中的某字段没有使用自行规定好的分词方式，而是使用内置解析器时，当搜索的关键词的字符数量不等于ngram_token_size定义大小时，会出现与实际情况不一致的问题。
- 当MySQL中的某字段使用自行规定好的分词方式，对该字段进行全文索引，能够在该字段内快速出现某个关键词的相关记录信息，实现简单搜索引擎的效果。
- 总结：全文索引可以起到快速搜索的效果，满足搜索引擎在短时间内获得搜索结果的要求。

### 实验心得：

